---
- name: Install Claude Code
  ansible.builtin.shell: |
    if ! command -v claude &>/dev/null; then
      curl -fsSL https://claude.ai/install.sh | bash
    fi
  become: true
  become_user: "{{ username }}"
  args:
    executable: /bin/bash
  register: claude_code_install
  changed_when: "'already installed' not in claude_code_install.stdout | default('')"

- name: Install Claude Desktop (AUR, non-fatal)
  kewlfft.aur.aur:
    name: claude-desktop-bin
    use: "{{ aur_helper }}"
    state: present
  become: true
  become_user: "{{ username }}"
  ignore_errors: true
  register: claude_desktop_result

- name: Notify if Claude Desktop unavailable
  ansible.builtin.debug:
    msg: "Claude Desktop AUR package not available. Install manually when ready."
  when: claude_desktop_result is failed

- name: Install Codex CLI via npm
  community.general.npm:
    name: "@openai/codex"
    global: true
    state: present
